// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --replace-value-regex "!annotation ![0-9]+" "!tbaa ![0-9]+" "!llvm.loop ![0-9]+" "#[0-9]+" --version 5

//
// RUN: %clang_cc1 -O2 -fbounds-safety -fno-bounds-safety-bringup-missing-checks=all -emit-llvm -triple x86_64 %s -o - | FileCheck %s

#include <ptrcheck.h>

struct buf {
  int member;
  int arr[10];
};

// CHECK-LABEL: define dso_local void @array_member_access_can_remove(
// CHECK-SAME: ptr noundef writeonly initializes((4, 8)) [[BP:%.*]]) local_unnamed_addr #[[ATTR0:[0-9]+]] {
// CHECK-NEXT:  [[CONT1:.*:]]
// CHECK-NEXT:    [[ARR:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 4
// CHECK-NEXT:    [[UPPER:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 44
// CHECK-NEXT:    store i32 0, ptr [[ARR]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_1:%.*]] = getelementptr i8, ptr [[BP]], i64 8
// CHECK-NEXT:    [[TMP0:%.*]] = icmp ult ptr [[ARRAYIDX_1]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP1:%.*]] = icmp uge ptr [[ARRAYIDX_1]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_1:%.*]] = and i1 [[TMP0]], [[TMP1]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_1]], label %[[CONT1_1:.*]], label %[[TRAP:.*]], {{!annotation ![0-9]+}}
// CHECK:       [[TRAP]]:
// CHECK-NEXT:    tail call void @llvm.ubsantrap(i8 25) {{#[0-9]+}}, {{!annotation ![0-9]+}}
// CHECK-NEXT:    unreachable, {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_1]]:
// CHECK-NEXT:    store i32 1, ptr [[ARRAYIDX_1]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_2:%.*]] = getelementptr i8, ptr [[BP]], i64 12
// CHECK-NEXT:    [[TMP2:%.*]] = icmp ult ptr [[ARRAYIDX_2]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP3:%.*]] = icmp uge ptr [[ARRAYIDX_2]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_2:%.*]] = and i1 [[TMP2]], [[TMP3]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_2]], label %[[CONT1_2:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_2]]:
// CHECK-NEXT:    store i32 2, ptr [[ARRAYIDX_2]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_3:%.*]] = getelementptr i8, ptr [[BP]], i64 16
// CHECK-NEXT:    [[TMP4:%.*]] = icmp ult ptr [[ARRAYIDX_3]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP5:%.*]] = icmp uge ptr [[ARRAYIDX_3]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_3:%.*]] = and i1 [[TMP4]], [[TMP5]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_3]], label %[[CONT1_3:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_3]]:
// CHECK-NEXT:    store i32 3, ptr [[ARRAYIDX_3]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_4:%.*]] = getelementptr i8, ptr [[BP]], i64 20
// CHECK-NEXT:    [[TMP6:%.*]] = icmp ult ptr [[ARRAYIDX_4]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP7:%.*]] = icmp uge ptr [[ARRAYIDX_4]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_4:%.*]] = and i1 [[TMP6]], [[TMP7]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_4]], label %[[CONT1_4:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_4]]:
// CHECK-NEXT:    store i32 4, ptr [[ARRAYIDX_4]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_5:%.*]] = getelementptr i8, ptr [[BP]], i64 24
// CHECK-NEXT:    [[TMP8:%.*]] = icmp ult ptr [[ARRAYIDX_5]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP9:%.*]] = icmp uge ptr [[ARRAYIDX_5]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_5:%.*]] = and i1 [[TMP8]], [[TMP9]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_5]], label %[[CONT1_5:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_5]]:
// CHECK-NEXT:    store i32 5, ptr [[ARRAYIDX_5]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_6:%.*]] = getelementptr i8, ptr [[BP]], i64 28
// CHECK-NEXT:    [[TMP10:%.*]] = icmp ult ptr [[ARRAYIDX_6]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP11:%.*]] = icmp uge ptr [[ARRAYIDX_6]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_6:%.*]] = and i1 [[TMP10]], [[TMP11]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_6]], label %[[CONT1_6:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_6]]:
// CHECK-NEXT:    store i32 6, ptr [[ARRAYIDX_6]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_7:%.*]] = getelementptr i8, ptr [[BP]], i64 32
// CHECK-NEXT:    [[TMP12:%.*]] = icmp ult ptr [[ARRAYIDX_7]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP13:%.*]] = icmp uge ptr [[ARRAYIDX_7]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_7:%.*]] = and i1 [[TMP12]], [[TMP13]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_7]], label %[[CONT1_7:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_7]]:
// CHECK-NEXT:    store i32 7, ptr [[ARRAYIDX_7]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_8:%.*]] = getelementptr i8, ptr [[BP]], i64 36
// CHECK-NEXT:    [[TMP14:%.*]] = icmp ult ptr [[ARRAYIDX_8]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP15:%.*]] = icmp uge ptr [[ARRAYIDX_8]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_8:%.*]] = and i1 [[TMP14]], [[TMP15]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_8]], label %[[CONT1_8:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_8]]:
// CHECK-NEXT:    store i32 8, ptr [[ARRAYIDX_8]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_9:%.*]] = getelementptr i8, ptr [[BP]], i64 40
// CHECK-NEXT:    [[TMP16:%.*]] = icmp ult ptr [[ARRAYIDX_9]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP17:%.*]] = icmp uge ptr [[ARRAYIDX_9]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_9:%.*]] = and i1 [[TMP16]], [[TMP17]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_9]], label %[[CONT1_9:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_9]]:
// CHECK-NEXT:    store i32 9, ptr [[ARRAYIDX_9]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    ret void
//
void array_member_access_can_remove(struct buf *bp) {
  for (int i = 0; i < 10; ++i)
     bp->arr[i] = i;
}

// CHECK-LABEL: define dso_local void @array_member_access_trap_on_last_iter(
// CHECK-SAME: ptr noundef writeonly initializes((4, 8)) [[BP:%.*]]) local_unnamed_addr #[[ATTR2:[0-9]+]] {
// CHECK-NEXT:  [[CONT1:.*:]]
// CHECK-NEXT:    [[ARR:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 4
// CHECK-NEXT:    [[UPPER:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 44
// CHECK-NEXT:    store i32 0, ptr [[ARR]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_1:%.*]] = getelementptr i8, ptr [[BP]], i64 8
// CHECK-NEXT:    [[TMP0:%.*]] = icmp ult ptr [[ARRAYIDX_1]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP1:%.*]] = icmp uge ptr [[ARRAYIDX_1]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_1:%.*]] = and i1 [[TMP0]], [[TMP1]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_1]], label %[[CONT1_1:.*]], label %[[TRAP:.*]], {{!annotation ![0-9]+}}
// CHECK:       [[TRAP]]:
// CHECK-NEXT:    tail call void @llvm.ubsantrap(i8 25) {{#[0-9]+}}, {{!annotation ![0-9]+}}
// CHECK-NEXT:    unreachable, {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_1]]:
// CHECK-NEXT:    store i32 1, ptr [[ARRAYIDX_1]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_2:%.*]] = getelementptr i8, ptr [[BP]], i64 12
// CHECK-NEXT:    [[TMP2:%.*]] = icmp ult ptr [[ARRAYIDX_2]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP3:%.*]] = icmp uge ptr [[ARRAYIDX_2]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_2:%.*]] = and i1 [[TMP2]], [[TMP3]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_2]], label %[[CONT1_2:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_2]]:
// CHECK-NEXT:    store i32 2, ptr [[ARRAYIDX_2]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_3:%.*]] = getelementptr i8, ptr [[BP]], i64 16
// CHECK-NEXT:    [[TMP4:%.*]] = icmp ult ptr [[ARRAYIDX_3]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP5:%.*]] = icmp uge ptr [[ARRAYIDX_3]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_3:%.*]] = and i1 [[TMP4]], [[TMP5]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_3]], label %[[CONT1_3:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_3]]:
// CHECK-NEXT:    store i32 3, ptr [[ARRAYIDX_3]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_4:%.*]] = getelementptr i8, ptr [[BP]], i64 20
// CHECK-NEXT:    [[TMP6:%.*]] = icmp ult ptr [[ARRAYIDX_4]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP7:%.*]] = icmp uge ptr [[ARRAYIDX_4]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_4:%.*]] = and i1 [[TMP6]], [[TMP7]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_4]], label %[[CONT1_4:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_4]]:
// CHECK-NEXT:    store i32 4, ptr [[ARRAYIDX_4]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_5:%.*]] = getelementptr i8, ptr [[BP]], i64 24
// CHECK-NEXT:    [[TMP8:%.*]] = icmp ult ptr [[ARRAYIDX_5]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP9:%.*]] = icmp uge ptr [[ARRAYIDX_5]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_5:%.*]] = and i1 [[TMP8]], [[TMP9]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_5]], label %[[CONT1_5:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_5]]:
// CHECK-NEXT:    store i32 5, ptr [[ARRAYIDX_5]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_6:%.*]] = getelementptr i8, ptr [[BP]], i64 28
// CHECK-NEXT:    [[TMP10:%.*]] = icmp ult ptr [[ARRAYIDX_6]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP11:%.*]] = icmp uge ptr [[ARRAYIDX_6]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_6:%.*]] = and i1 [[TMP10]], [[TMP11]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_6]], label %[[CONT1_6:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_6]]:
// CHECK-NEXT:    store i32 6, ptr [[ARRAYIDX_6]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_7:%.*]] = getelementptr i8, ptr [[BP]], i64 32
// CHECK-NEXT:    [[TMP12:%.*]] = icmp ult ptr [[ARRAYIDX_7]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP13:%.*]] = icmp uge ptr [[ARRAYIDX_7]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_7:%.*]] = and i1 [[TMP12]], [[TMP13]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_7]], label %[[CONT1_7:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_7]]:
// CHECK-NEXT:    store i32 7, ptr [[ARRAYIDX_7]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_8:%.*]] = getelementptr i8, ptr [[BP]], i64 36
// CHECK-NEXT:    [[TMP14:%.*]] = icmp ult ptr [[ARRAYIDX_8]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP15:%.*]] = icmp uge ptr [[ARRAYIDX_8]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_8:%.*]] = and i1 [[TMP14]], [[TMP15]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_8]], label %[[CONT1_8:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_8]]:
// CHECK-NEXT:    store i32 8, ptr [[ARRAYIDX_8]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[ARRAYIDX_9:%.*]] = getelementptr i8, ptr [[BP]], i64 40
// CHECK-NEXT:    [[TMP16:%.*]] = icmp ult ptr [[ARRAYIDX_9]], [[UPPER]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP17:%.*]] = icmp uge ptr [[ARRAYIDX_9]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND_9:%.*]] = and i1 [[TMP16]], [[TMP17]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND_9]], label %[[CONT1_9:.*]], label %[[TRAP]], {{!annotation ![0-9]+}}
// CHECK:       [[CONT1_9]]:
// CHECK-NEXT:    store i32 9, ptr [[ARRAYIDX_9]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    br label %[[TRAP]], {{!annotation ![0-9]+}}
//
void array_member_access_trap_on_last_iter(struct buf *bp) {
  for (int i = 0; i < 11; ++i)
     bp->arr[i] = i;
}

struct buf_var_size {
  unsigned size;
  int arr[__counted_by(size)];
};

// CHECK-LABEL: define dso_local void @array_member_access_can_remove_variable(
// CHECK-SAME: ptr noundef [[BP:%.*]]) local_unnamed_addr #[[ATTR0]] {
// CHECK-NEXT:  [[ENTRY:.*:]]
// CHECK-NEXT:    [[TMP0:%.*]] = load i32, ptr [[BP]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[CMP14_NOT:%.*]] = icmp eq i32 [[TMP0]], 0
// CHECK-NEXT:    br i1 [[CMP14_NOT]], label %[[FOR_COND_CLEANUP:.*]], label %[[FOR_BODY_LR_PH:.*]]
// CHECK:       [[FOR_BODY_LR_PH]]:
// CHECK-NEXT:    [[ARR:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 4
// CHECK-NEXT:    [[IDX_EXT:%.*]] = zext i32 [[TMP0]] to i64
// CHECK-NEXT:    [[ADD_PTR:%.*]] = getelementptr inbounds nuw i32, ptr [[ARR]], i64 [[IDX_EXT]]
// CHECK-NEXT:    br label %[[FOR_BODY:.*]]
// CHECK:       [[FOR_COND_CLEANUP]]:
// CHECK-NEXT:    ret void
// CHECK:       [[FOR_BODY]]:
// CHECK-NEXT:    [[INDVARS_IV:%.*]] = phi i64 [ 0, %[[FOR_BODY_LR_PH]] ], [ [[INDVARS_IV_NEXT:%.*]], %[[CONT9:.*]] ]
// CHECK-NEXT:    [[ARRAYIDX:%.*]] = getelementptr i32, ptr [[ARR]], i64 [[INDVARS_IV]]
// CHECK-NEXT:    [[TMP1:%.*]] = icmp ult ptr [[ARRAYIDX]], [[ADD_PTR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP2:%.*]] = icmp uge ptr [[ARRAYIDX]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND:%.*]] = and i1 [[TMP2]], [[TMP1]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND]], label %[[CONT9]], label %[[TRAP:.*]], {{!annotation ![0-9]+}}
// CHECK:       [[TRAP]]:
// CHECK-NEXT:    tail call void @llvm.ubsantrap(i8 25) {{#[0-9]+}}, {{!annotation ![0-9]+}}
// CHECK-NEXT:    unreachable, {{!annotation ![0-9]+}}
// CHECK:       [[CONT9]]:
// CHECK-NEXT:    [[TMP3:%.*]] = trunc nuw nsw i64 [[INDVARS_IV]] to i32
// CHECK-NEXT:    store i32 [[TMP3]], ptr [[ARRAYIDX]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[INDVARS_IV_NEXT]] = add nuw nsw i64 [[INDVARS_IV]], 1
// CHECK-NEXT:    [[EXITCOND_NOT:%.*]] = icmp eq i64 [[INDVARS_IV_NEXT]], [[IDX_EXT]]
// CHECK-NEXT:    br i1 [[EXITCOND_NOT]], label %[[FOR_COND_CLEANUP]], label %[[FOR_BODY]], {{!llvm.loop ![0-9]+}}
//
void array_member_access_can_remove_variable(struct buf_var_size *bp) {
  for (int i = 0; i < bp->size; ++i)
     bp->arr[i] = i;
}

// CHECK-LABEL: define dso_local void @array_member_access_cannot_remove_variable(
// CHECK-SAME: ptr noundef [[BP:%.*]], i32 noundef [[N:%.*]]) local_unnamed_addr #[[ATTR0]] {
// CHECK-NEXT:  [[ENTRY:.*:]]
// CHECK-NEXT:    [[CMP12_NOT:%.*]] = icmp eq i32 [[N]], 0
// CHECK-NEXT:    br i1 [[CMP12_NOT]], label %[[FOR_COND_CLEANUP:.*]], label %[[FOR_BODY_LR_PH:.*]]
// CHECK:       [[FOR_BODY_LR_PH]]:
// CHECK-NEXT:    [[ARR:%.*]] = getelementptr inbounds nuw i8, ptr [[BP]], i64 4
// CHECK-NEXT:    [[TMP0:%.*]] = load i32, ptr [[BP]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[IDX_EXT:%.*]] = zext i32 [[TMP0]] to i64
// CHECK-NEXT:    [[ADD_PTR:%.*]] = getelementptr inbounds nuw i32, ptr [[ARR]], i64 [[IDX_EXT]]
// CHECK-NEXT:    [[WIDE_TRIP_COUNT:%.*]] = zext i32 [[N]] to i64
// CHECK-NEXT:    br label %[[FOR_BODY:.*]]
// CHECK:       [[FOR_COND_CLEANUP]]:
// CHECK-NEXT:    ret void
// CHECK:       [[FOR_BODY]]:
// CHECK-NEXT:    [[INDVARS_IV:%.*]] = phi i64 [ 0, %[[FOR_BODY_LR_PH]] ], [ [[INDVARS_IV_NEXT:%.*]], %[[CONT8:.*]] ]
// CHECK-NEXT:    [[ARRAYIDX:%.*]] = getelementptr i32, ptr [[ARR]], i64 [[INDVARS_IV]]
// CHECK-NEXT:    [[TMP1:%.*]] = icmp ult ptr [[ARRAYIDX]], [[ADD_PTR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[TMP2:%.*]] = icmp uge ptr [[ARRAYIDX]], [[ARR]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    [[OR_COND:%.*]] = and i1 [[TMP2]], [[TMP1]], {{!annotation ![0-9]+}}
// CHECK-NEXT:    br i1 [[OR_COND]], label %[[CONT8]], label %[[TRAP:.*]], {{!annotation ![0-9]+}}
// CHECK:       [[TRAP]]:
// CHECK-NEXT:    tail call void @llvm.ubsantrap(i8 25) {{#[0-9]+}}, {{!annotation ![0-9]+}}
// CHECK-NEXT:    unreachable, {{!annotation ![0-9]+}}
// CHECK:       [[CONT8]]:
// CHECK-NEXT:    [[TMP3:%.*]] = trunc nuw nsw i64 [[INDVARS_IV]] to i32
// CHECK-NEXT:    store i32 [[TMP3]], ptr [[ARRAYIDX]], align 4, {{!tbaa ![0-9]+}}
// CHECK-NEXT:    [[INDVARS_IV_NEXT]] = add nuw nsw i64 [[INDVARS_IV]], 1
// CHECK-NEXT:    [[EXITCOND_NOT:%.*]] = icmp eq i64 [[INDVARS_IV_NEXT]], [[WIDE_TRIP_COUNT]]
// CHECK-NEXT:    br i1 [[EXITCOND_NOT]], label %[[FOR_COND_CLEANUP]], label %[[FOR_BODY]], {{!llvm.loop ![0-9]+}}
//
void array_member_access_cannot_remove_variable(struct buf_var_size *bp, unsigned n) {
  for (int i = 0; i < n; ++i)
     bp->arr[i] = i;
}
